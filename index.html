<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro y Sesión</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="main">
        <h3 v-if="!isLoggedIn">
            Registro e Iniciar sesión
        </h3>

        <!-- Formulario  -->
        <form v-if="!isLoggedIn" @submit.prevent="registerAndLogin">
            <fieldset>
                <label for="nombreLogin">Nombre:</label>
                <input type="text" v-model="loginData.nombre" placeholder="Escribe tu nombre" id="nombreLogin" required>
            </fieldset>
            <fieldset>
                <label for="password">Contraseña:</label>
                <input type="password" v-model="loginData.password" placeholder="Escribe tu contraseña" id="password" required>
            </fieldset>
            <button type="submit">Registrarse e Iniciar Sesión</button>
            <p v-if="errorMessage" style="color: red;">{{ errorMessage }}</p> 
        </form>

        <div v-if="isLoggedIn">
            <h3>Bienvenido, {{ sessionData.nombre }}!</h3>
            <button @click="logout">Cerrar sesión</button>
            <button @click="toggleTable">Tabla</button>

            <hr>

            <!-- Tabla  -->
            <table v-if="showTable">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Nombre</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    <tr v-for="(user, index) in storedUsers" :key="user.nombre">
                        <td>{{ index + 1 }}</td>
                        <td>{{ user.nombre }}</td>
                        <td>
                            <div class="action-btns">
                                <button class="edit-btn">Editar</button>
                                <button class="delete-btn">Eliminar</button>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

    <script>
      const { createApp, ref, onMounted } = Vue
    
      createApp({
        setup() {
          const loginData = ref({ nombre: '', password: '' })
          const sessionData = ref({})
          const storedUsers = ref([]) 
          const isLoggedIn = ref(false)
          const errorMessage = ref('') 
          const showTable = ref(false) 

          //REGISTRO E INICIO DE SESION
          const registerAndLogin = () => {
            const newUser = {
              nombre: loginData.value.nombre,
              password: loginData.value.password
            }

            const users = JSON.parse(localStorage.getItem('users')) || []

            //REVISAR SI EL USUARIO YA ESTA REGISTRADO
            const userExists = users.some(user => user.nombre === newUser.nombre && user.password === newUser.password)
            if (userExists) {
              errorMessage.value = 'El usuario ya existe con el mismo nombre y contraseña.'
              return
            }

            users.push(newUser)
            localStorage.setItem('users', JSON.stringify(users))

            //INICIAR SESION USUARIO
            sessionStorage.setItem('user', JSON.stringify(newUser))
            sessionData.value = newUser
            isLoggedIn.value = true

            storedUsers.value = users
            errorMessage.value = ''
          }

          //LOGOUT
          const logout = () => {
            sessionStorage.removeItem('user')
            sessionData.value = {}
            isLoggedIn.value = false
            showTable.value = false 
          }

          
          const toggleTable = () => {
            showTable.value = !showTable.value
          }

          
          const checkSession = () => {
            const storedUser = sessionStorage.getItem('user')
            if (storedUser) {
              sessionData.value = JSON.parse(storedUser)
              isLoggedIn.value = true
            }
          }

          
          const loadStoredUsers = () => {
            const users = JSON.parse(localStorage.getItem('users')) || []
            storedUsers.value = users
          }

          onMounted(() => {
            checkSession()       
            loadStoredUsers()      
          })

          return {
            loginData,
            sessionData,
            storedUsers,
            isLoggedIn,
            errorMessage,
            showTable,
            registerAndLogin,
            logout,
            toggleTable
          }
        }
      }).mount('#main')
    </script>
</body>
</html>












